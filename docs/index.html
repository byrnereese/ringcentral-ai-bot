<!DOCTYPE html><html><head><title>Building a RingCentral AI Chatbot- RingCentral Developer Tutorials</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" sizes="72x72" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" sizes="114x114" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/jquery-ui@1.12.1/themes/base/all.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div class="dpw-header-container"><div class="dpw-header center-section"><div class="logo"><a href="https://developers.ringcentral.com" class="logo-link"></a></div><div class="nav-top-menus"></div><div class="dpw-login-section"><a href="https://developer.ringcentral.com/login.html#/">Sign in | Sign up</a></div></div></div><div id="viewsaurus" data-title="Building a RingCentral AI Chatbot"><div class="saurus-panes"><div class="saurus-panes-header"><a href="https://ringcentral.github.io/tutorials/" class="saurus-back-to-tutorials">Tutorials</a><span>&gt;</span><span>Building a RingCentral AI Chatbot</span></div><div class="saurus-prose"><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw icon-menu"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Welcome to RingCentral AI Chatbot tutorial! This tutorial will guide you through building a complete, public chatbot including user auth to third party services, subscribing to notifications, processing events and posting messages.

Click the &quot;Start&quot; button below to see how Viewsaurus works.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="RingCentral AI Bot" class="chapter"><div data-title="Overview" data-file="../src/lamda/lib/bot-oauth.js" data-highlight="10-13" class="step"><h2 id="overview">Overview</h2>
<ol>
<li>Prepare the devement env</li>
<li>Core Bot Functionality<ol>
<li><a href="#1">Bot Auth</a></li>
<li>Subscribing for Bot Events</li>
<li>Creating Posts</li>
</ol>
</li>
<li>Adding a Bot<ol>
<li>Add to Glip Button</li>
<li>Welcome Message</li>
</ol>
</li>
<li>Linking to Services</li>
<li>Responding to Events<ol>
<li>Bot Events</li>
<li>Service Events</li>
</ol>
</li>
<li>Installing and running the bot</li>
</ol>
</div><div data-title="Prerequisites" data-file="../README.md" data-highlight="10-35" class="step"><h2 id="prepare-the-devement-env">Prepare the devement env</h2>
<p>Follow the readme&#39;s insruction, create required App, set proper env, get the development env ready.</p>
</div><div data-title="Adding the Bot" data-file="../src/lamda/lib/bot-oauth.js" data-highlight="10-13" class="step"><h2 id="adding-the-bot">Adding the Bot</h2>
<p>A bot is installed into a RingCentral account when the user clicks the &quot;Add to Glip&quot; button which creates and adds the bot to the account. The &quot;Add to Glip&quot; button is in the Developer Portal for development and the <a href="https://ringcentral.com/apps">RingCentral App Gallery</a> for graduated, public bots. Ensure you have configured your bot OAuth webhook in the Developer Portal. The development button looks like the following:</p>
<p><img src="images/ringcentral-ai-bot_add-to-glip-button-sandbox.png" alt=""></p>
</div><div data-title="Bot Authentication" data-file="../src/lamda/lib/store.js" data-highlight="81-95" class="step"><h2 id="bot-authentication">Bot Authentication</h2>
<p>When the button is clicked, the user will be presented with an OAuth 2.0 login flow that ends with the browser being redirected to your redirect URL which will then need to retrieve the authorization code from the query string parameter and exchange it for an access token.</p>
<p>For a public bot, you will need one token per account and can save the token by using the bot&#39;s <code>personId</code> which is returned as the <code>owner_id</code> with the <code>access_token</code>.</p>
</div><div data-title="Subscribing for Events" data-file="../src/lamda/lib/store.js" data-highlight="96-120" class="step"><h2 id="subscribing-for-events">Subscribing for Events</h2>
<p>The bot interacts with Glip by receiving posts from users and group events it&#39;s a member of. To subscribe to to these events, create a subscription with the <code>/restapi/v1.0/subscription</code> API.</p>
<p>The event filters are shown in the next section.</p>
</div><div data-title="Event Filters" data-file="../src/lamda/lib/store.js" data-highlight="12-16" class="step"><h2 id="event-filters">Event Filters</h2>
<p>To listen for commands in Glip, the bot needs to subscribe for events via event filters. Two event filters of use include:</p>
<ul>
<li><code>glip/posts</code> for user commands and</li>
<li><code>glip/groups</code> for when the bot is invited to a group</li>
</ul>
</div><div data-title="Creating Posts" data-file="../src/lamda/lib/store.js" data-highlight="146-152" class="step"><h2 id="creating-posts">Creating Posts</h2>
<p>To create a post use the Glip Create Post API:</p>
<p><code>/restapi/v1.0/glip/groups/{groupId}/posts</code></p>
<p>This requires sending the bot access token in the <code>Authorization</code> header as the <code>Bearer</code> token value.</p>
<p>The bot automatically handles both creating a new post and authorization.</p>
<p>More information on the API is available here:</p>
<ul>
<li><a href="https://developer.ringcentral.com/api-reference#Posts-createGlipGroupPost">Create Post API</a></li>
</ul>
</div><div data-title="Creating the Welcome Message" data-file="../src/lamda/lib/bot-webhook.js" data-highlight="21-29" class="step"><h2 id="creating-the-welcome-message">Creating the Welcome Message</h2>
<p>To post a welcome message to a user when the bot is added to a new team, perform the following.</p>
<ol>
<li>Subscribe for the glip/groups event filter</li>
<li>When receiving an incoming event, identify an event for joining a private chat with the following event: <code>body.eventType</code> == <code>GroupJoined</code> &amp;&amp; <code>body.type</code> == <code>PrivateChat</code></li>
<li>Post your welcome message.</li>
</ol>
<p>When posting back, use the following steps:</p>
<ol>
<li>Use the event <code>ownerId</code> to identify the bot user and retrieve the proper access token.</li>
<li>Post back to the <code>body.groupId</code></li>
<li>Optionally at mention the user by loading the user&#39;s <code>personId</code> by calling the <code>group/{groupId}</code> endpoint and filtering the array of `members.</li>
</ol>
</div><div data-title="Linking User Accounts" data-file="../src/lamda/lib/bot-webhook.js" data-highlight="84-88" class="step"><h2 id="linking-user-accounts">Linking User Accounts</h2>
<p>To have the bot access user data for RingCentral or other accounts, have the bot offer to launch an OAuth flow via a link in the Glip chat.</p>
<p>When the user clicks on the link, launch the OAuth flow and then return to a redirect URL for the user flow.</p>
</div><div data-title="Saving the User Token" data-file="../src/lamda/lib/store.js" data-highlight="200-215" class="step"><h2 id="saving-the-user-token">Saving the User Token</h2>
<p>Similar to saving the bot token, you will need to save the user token for each user.</p>
</div><div data-title="Link Account Success" data-file="../src/lamda/lib/store.js" data-highlight="249-262" class="step"><h2 id="link-account-success">Link Account Success</h2>
<p>After the account has been linked, performe the needed service and return a successful message to the user.</p>
<p>In this case, we will use the user access token to create a subscription for new voicemail using the <code>/restapi/v1.0/account/~/extension/~/message-store</code> event filter defined in the variable <code>userEventFilters</code>.</p>
</div></div><div data-title="Processing Events" data-file="../src/lamda/lib/voicemail-process.js" data-highlight="17-43" class="step"><h2 id="processing-events">Processing Events</h2>
<p>When you receive the new voicemail event, process the voicemail by transcribing it to text and then analyzing the text.</p>
</div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="../src/lamda/lib/bot-oauth.js" data-mode="javascript">LyoqCiAqIHVzZXIgb2F1dGggYnkgdHlsZXIKICovCgppbXBvcnQge3Jlc3VsdH0gZnJvbSAnLi9jb21tb24nCgppbXBvcnQge0JvdH0gZnJvbSAnLi9zdG9yZScKCmV4cG9ydCBkZWZhdWx0IGFzeW5jIChldmVudCkgPT4gewogIGNvbnN0IGJvdCA9IG5ldyBCb3QoKQogIGF3YWl0IGJvdC5hdXRob3JpemUoZXZlbnQucXVlcnlTdHJpbmdQYXJhbWV0ZXJzLmNvZGUpCiAgYXdhaXQgYm90LnJlbmV3V2ViSG9va3MoKQogIHJldHVybiByZXN1bHQoJ0JvdCBhZGRlZCcpCn0K</textarea>
<textarea class="saurus-file" data-file="../README.md" data-mode="markdown">IyBSaW5nQ2VudHJhbCBBSSBCb3QKClJpbmdDZW50cmFsIEdsaXAgdm9pY2VtYWlsIEFJIGJvdCBQT0MuCgojIyBGZWF0dXJlcwpSZWFkIEdsaXAgdXNlcidzIG5ldyB2b2ljZW1haWwsIHRyYW5zY3JpYmUgdGhlIHZvaWNlIHRvIHRleHQsIGFuYWx5emUgdGhlIHRleHQgd2l0aCBHb29nbGUgQUksIGFuZCBzZW5kIHRoZSByZXN1bHRzIHRvIHVzZXIgYXV0aHVyaXplZCBjaGF0IGdyb3VwLgoKIyMgUHJlcmVxdWlzaXRlcwoKLSBOb2RlLmpzID49IDguMTAKLSByZWdpc3RlciBHb29nbGUgY2xvdWQgYWNjb3VudCBhbmQgc2V0IHBheW1lbnQgbWV0aG9kLCBkb3dubG9hZCB5b3VyIGNyZWRlbnRpYWwganNvbi4KLSBDcmVhdGUgYSBib3QgYXBwIGluIFtSaW5nQ2VudHJhbCBkZXZlbG9wZXIgc2l0ZV0oaHR0cHM6Ly9kZXZlbG9wZXJzLnJpbmdjZW50cmFsLmNvbSksIHdpdGggcGVybWlzc2lvbnM6IGBSZWFkQ29udGFjdHMgUmVhZE1lc3NhZ2VzIFJlYWRQcmVzZW5jZSBDb250YWN0cyBSZWFkQWNjb3VudHMgU01TIEludGVybmFsTWVzc2FnZXMgUmVhZENhbGxMb2cgUmVhZENhbGxSZWNvcmRpbmcgU3Vic2NyaXB0aW9uV2ViaG9vayBHbGlwYCwgc2V0IGBPQXV0aCBSZWRpcmVjdCBVUklgIHRvIGBodHRwczovL3lvdXItbmdyb2stYWRkci5uZ3Jvay5pby9ib3Qtb2F1dGhgCi0gQ3JlYXRlIGEgYnJvd3NlciBiYXNlZCBhcHAgaW4gUmluZ0NlbnRyYWwgZGV2ZWxvcGVyIHNpdGUsIHdpdGggYWxsIHBlcm1pc3Npb25zLCBzZXQgYE9BdXRoIFJlZGlyZWN0IFVSSWAgdG8gYGh0dHBzOi8veW91ci1uZ3Jvay1hZGRyLm5ncm9rLmlvL3VzZXItb2F1dGhgLgoKIyMgZGV2CgpgYGBiYXNoCmdpdCBjbG9uZSBnaXRAZ2l0aHViLmNvbTpyaW5nY2VudHJhbC10dXRvcmlhbHMvcmluZ2NlbnRyYWwtYWktYm90LmdpdAojIG9yIGdpdCBjbG9uZSBodHRwczovL2dpdGh1Yi5jb20vcmluZ2NlbnRyYWwtdHV0b3JpYWxzL3JpbmdjZW50cmFsLWFpLWJvdC5naXQKY2QgcmluZ2NlbnRyYWwtYWktYm90Cnlhcm4KCiMgY3JlYXRlIGNvbmZpZwpjcCAuc2FtcGxlLmVudiAuZW52CiMgdGhlbiBlZGl0IC5lbnYsIGZpbGwgcmluZ2NlbnRyYWwgYXBwIGNvbmZpZ3MKCiMjIHN0YXJ0IGxvY2FsIGxhbWRhIHNlcnZlcgp5YXJuIGRldgoKIyMgc3RhcnQgYSBuZ3JvayBwcm94eSB0byBsb2NhbCBwb3J0Cnlhcm4gcHJveHkKIyBodHRwczovL3h4eHh4eC5uZ3Jvay5pbyAtLS0+IGh0dHA6Ly9sb2NhbGhvc3Q6Nzg2NwojIHlvdSBjYW4gY2hlY2sgbmdyb2sgc3RhdHVzIGZyb20gaHR0cDovL2xvY2FsaG9zdDo0MDQwCmBgYAoKIyMgQnVpbGQgYW5kIFJ1biBpbiBwcm9kdWN0aW9uIGVudgoKYGBgYmFzaAojIGluc3RhbGwgcG0yIGZpcnN0IGlmIHlvdSB3YW5uYSB1c2UgcG0yCnlhcm4gZ2xvYmFsIGFkZCBwbTIKIyBvciBgbnBtIGkgLWcgcG0yYAoKIyBidWlsZAp5YXJuIGJ1aWxkCgojIHJ1biBwcm9kdWN0aW9uIHNlcnZlcgp5YXJuIHByb2Qtc2VydmVyCgojIHVzZSBwbTIKcG0yIHN0YXJ0IGJpbi9wbTIueW1sCmBgYAoKIyMgVGVzdCB0aGUgYm90Ci0gR290byB5b3VyIHJpbmdjZW50cmFsIGRldmVsb3BlciBzaXRlLCBpbiBib3QgYXBwJ3MgYm90IHBhZ2UsIGNsaWNrIGBhZGQgdG8gZ2xpcGAKLSBMb2dpbiB0byBodHRwczovL2dsaXAtYXBwLmRldnRlc3QucmluZ2NlbnRyYWwuY29tLCBjbGljayBib3QgdG8gc3RhcnQgdGhlIGNoYXQsIGp1c3QgZm9sbG93IHRoZSBib3QncyBpbnN0cnVjdGlvbnMKCiMjIEJ1aWxkIGFuZCBkZXBsb3kgdG8gQVdTIExhbWJkYQoKQVdTIGxhbWRhIHdpdGggYXBpIGdhdGUgd2F5IGFuZCBkeW5hbW9kYiB3b3VsZCBnaXZlIHVzIGEgZmxleGlibGUgd2F5IHRvIGRlcGxveSBib3QuCgotICoqT05MWSB3b3JrcyBpbiBsaW51eCoqLCBBV1MgbGFtZGEgaXMgaW4gbGludXggeDY0LCBzb21lIGRlcGVuZGVuY2llcyBuZWVkIHRvIGJlIHByZWJ1aWx0IGFuZCB1cGxvYWQgdG8gbGFtZGEsIHNvIG5lZWQgdGhlIGJ1aWxkIHByb2Nlc3MgaW4gbGludXggeDY0LCB5b3UgY291bGQgZG8gaXQgaW4gY2kgb3IgYW55IGxpbnV4IHNlcnZlci9kZXN0b3AgZW52LgoKLSBHZXQgYSBhd3MgYWNjb3VudCwgY3JlYXRlIGF3c19hY2Nlc3Nfa2V5X2lkIGFuZCBhd3Nfc2VjcmV0X2FjY2Vzc19rZXksIHB1dCBpdCBpbiBgfi8uYXdzL2NyZWRlbnRpYWxzYCwgbGlrZSB0aGlzOgpgYGBiYXNoCltkZWZhdWx0XQphd3NfYWNjZXNzX2tleV9pZCA9IDx5b3VyIGF3c19hY2Nlc3Nfa2V5X2lkPgphd3Nfc2VjcmV0X2FjY2Vzc19rZXkgPSA8eW91ciBhd3Nfc2VjcmV0X2FjY2Vzc19rZXk+CmBgYApyZWZlciB0byBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vZ2VuZXJhbC9sYXRlc3QvZ3IvYXdzLXNlY3VyaXR5LWNyZWRlbnRpYWxzLmh0bWwuCgoKYGBgYmFzaApjcCBsYW1kYS9zZXJ2ZXJsZXNzLnNhbXBsZS55bWwgbGFtZGEvc2VydmVybGVzcy55bWwKYGBgCkVkaXQgYGxhbWRhL3NlcnZlcmxlc3MueW1sYCwgbWFrZSBzdXJlIHlvdSBzZXQgcHJvcGVyIG5hbWUgYW5kIHJlcXVpcmVkIGVudgpgYGB5bWwKIyB5b3UgY2FuIGRlZmluZSBzZXJ2aWNlIHdpZGUgZW52aXJvbm1lbnQgdmFyaWFibGVzIGhlcmUKICBlbnZpcm9ubWVudDoKICAgIE5PREVfRU5WOiBwcm9kdWN0aW9uCiAgICAjIHJpbmdjZW50cmFsIGFwcHMKCiAgICAjIyBib3RzCiAgICBSSU5HQ0VOVFJBTF9CT1RfQ0xJRU5UX0lEOgogICAgUklOR0NFTlRSQUxfQk9UX0NMSUVOVF9TRUNSRVQ6CgogICAgIyMgdXNlcgogICAgUklOR0NFTlRSQUxfVVNFUl9DTElFTlRfSUQ6CiAgICBSSU5HQ0VOVFJBTF9VU0VSX0NMSUVOVF9TRUNSRVQ6CgogICAgIyMgY29tbW9uCiAgICBSSU5HQ0VOVFJBTF9TRVJWRVI6IGh0dHBzOi8vcGxhdGZvcm0uZGV2dGVzdC5yaW5nY2VudHJhbC5jb20KICAgIFJJTkdDRU5UUkFMX0JPVF9TRVJWRVI6IGh0dHBzOi8veHh4eC5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZWZhdWx0L3BvYy15b3VyLWJvdC1uYW1lLWRldi1ib3QKCiAgICAjIyBmb3IgZ29vZ2xlIGNsb3VkIGFwaSBjcmVuZGVudGlhbCBwYXRoCiAgICBHT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFM6IHBhdGgvdG8vZ29vZ2xlLWNyZWRlbnRpYWwuanNvbgoKICAgICMgZGIKICAgIERCX1RZUEU6IGR5bmFtb2RiCiAgICBEWU5BTU9EQl9UQUJMRV9QUkVGSVg6IHJjX2FpX2JvdDEKICAgIERZTkFNT0RCX1JFR0lPTjogdXMtZWFzdC0xCgpgYGAKCkRlcGxveSB0byBhd3MgbGFtZGEgd2l0aCBgbnBtIHJ1biBkZXBsb3lgCmBgYGJhc2gKIyBtYWtlIHN1cmUgeW91IGhhdmUgeWFybiwgY291bGQgdXNlIGBucG0gaSAtZyB5YXJuIHRvIGluc3RhbGxgCiMgdGhlbiBydW4gdGhpcyBjbWQgdG8gZGVwbG95IHRvIGF3cyBsYW1kYSwgZnVsbCBidWlsZCwgbWF5IHRha2UgbW9yZSB0aW1lCm5wbSBydW4gZGVwbG95CgojIyB3YXRjaCBsYW1kYSBzZXJ2ZXIgbG9nCm5wbSBydW4gd2F0Y2gKCiMjIHVwZGF0ZSBmdW5jdGlvbgpucG0gcnVuIHVwZGF0ZQoKIyMgdXBkYXRlIHdpdGhvdXQgYnVpbGQsIGZhc3QgdXBkYXRlLCBubyByZWJ1aWxkCm5wbSBydW4gdQpgYGAKLSBDcmVhdGUgYXBpIGdhdGV3YXkgZm9yIHlvdXIgbGFtZGEgZnVuY3Rpb24sIHNoYXBlIGFzIGBodHRwczovL3h4eHguZXhlY3V0ZS1hcGkudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vZGVmYXVsdC9wb2MteW91ci1ib3QtbmFtZS1kZXYtYm90L3thY3Rpb24rfWAKLSBNYWtlIHN1cmUgeW91ciBsYW1kYSBmdW5jdGlvbiByb2xlIGhhcyBwZXJtaXNzaW9uIHRvIHJlYWQvd3JpdGUgZHluYW1vZGIoU2V0IHRoaXMgZnJvbSBhd3MgSUFNIHJvbGVzLCBjb3VsZCBzaW1wbHkgYXR0YWNoIGBBbWF6b25EeW5hbW9EQkZ1bGxBY2Nlc3NgIHBvbGljeSB0byBsYW1kYSBmdW5jdGlvbidzIHJvbGUpCi0gTWFrZSBzdXJlIHlvdXIgbGFtZGEgZnVuY3Rpb24ncyB0aW1lb3V0IG1vcmUgdGhhbiA1IG1pbnV0ZXMKLSBEbyBub3QgZm9yZ2V0IHRvIHNldCB5b3VyIHJpbmdjZW50cmFsIGFwcCdzIHJlZGlyZWN0IFVSTCB0byBsYW1kYSdzIGFwaSBnYXRld2F5IHVybCwgYGh0dHBzOi8veHh4eC5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZWZhdWx0L3BvYy15b3VyLWJvdC1uYW1lLWRldi1ib3QvYm90LW9hdXRoYCBmb3IgYm90IGFwcCwgYGh0dHBzOi8veHh4eC5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZWZhdWx0L3BvYy15b3VyLWJvdC1uYW1lLWRldi1ib3QvdXNlci1vYXV0aGAgZm9yIHVzZXIgYXBwLgoKIyMgQ3JlZGl0cwotIFRoZSBjb25jZXB0IG9mIHRoaXMgYm90IGlzIGRlc2lnbmVkIGJ5IFtAZ3Jva2lmeV0oaHR0cHM6Ly9naXRodWIuY29tL2dyb2tpZnkpCi0gW0B0eWxlcmxvbmddKGh0dHBzOi8vZ2l0aHViLmNvbS90eWxlcmxvbmcpIFdyb3RlIHRoZSBjb3JlIGJvdCBsb2dpYwoKIyMgRG9jdW1lbnRzICYgUmVmZXJlbmNlCi0gaHR0cHM6Ly9kZXZlbG9wZXIucmluZ2NlbnRyYWwuY29tL2xlZ2FjeS1hcGktcmVmZXJlbmNlL2luZGV4Lmh0bWwjISNPdmVydmlldy5odG1sCi0gaHR0cHM6Ly9yaW5nY2VudHJhbC1hcGktZG9jcy5yZWFkdGhlZG9jcy5pby9lbi9sYXRlc3QvZ2xpcF9ib3RzLwotIGh0dHBzOi8vZ2l0aHViLmNvbS9ncm9raWZ5L3JpbmdjZW50cmFsLXBvbGxpbmctYW5kLXN5bmNpbmcKLSBodHRwczovL2dpdGh1Yi5jb20vcmluZ2NlbnRyYWwvcmluZ2NlbnRyYWwtanMKLSBodHRwczovL2dpdGh1Yi5jb20vdHlsZXJsb25nL3JpbmdjZW50cmFsLWpzLWNvbmNpc2UKLSBodHRwczovL2dpdGh1Yi5jb20vZ3Jva2lmeS9ncm91cGJvdAotIGh0dHBzOi8vZ2l0aHViLmNvbS90eWxlcmxvbmcvc3VieAotIGh0dHBzOi8vZ2l0aHViLmNvbS96eGRvbmcyNjIvYXVkaW8tYW5hbHlzaXMtc2VydmljZSAoVm9pY2UgdHJhbnNjcmlwdC9hbmFseXNpcyByZWxhdGVkIGV4dGVybmFsIHNlcnZpY2UpCgojIyBMaWNlbnNlCgpNSVQKCg==</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/store.js" data-mode="javascript">CmltcG9ydCBTdWJ4IGZyb20gJ3N1YngnCmltcG9ydCBSaW5nQ2VudHJhbCBmcm9tICdyaW5nY2VudHJhbC1qcy1jb25jaXNlJwppbXBvcnQge3Byb2Nlc3NNYWlsfSBmcm9tICcuL3ZvaWNlbWFpbC1wcm9jZXNzJwppbXBvcnQgZGIgZnJvbSAnLi9kYicKaW1wb3J0IHsKICBsb2csIHRhYmxlcywgcmVzdWx0Rm9ybWF0dGVyLAogIHN1YnNjcmliZUludGVydmFsLCBleHBpcmVzSW4sIGhhbmRsZVJDRXJyb3IKfSBmcm9tICcuL2NvbW1vbicKaW1wb3J0IF8gZnJvbSAnbG9kYXNoJwoKY29uc3QgYm90RXZlbnRGaWx0ZXJzID0gKCkgPT4gWwogICcvcmVzdGFwaS92MS4wL2dsaXAvcG9zdHMnLAogICcvcmVzdGFwaS92MS4wL2dsaXAvZ3JvdXBzJwpdCgpjb25zdCB1c2VyRXZlbnRGaWx0ZXJzID0gKCkgPT4gWwogICcvcmVzdGFwaS92MS4wL2FjY291bnQvfi9leHRlbnNpb24vfi9tZXNzYWdlLXN0b3JlJywKICBzdWJzY3JpYmVJbnRlcnZhbCgpCl0KCmZ1bmN0aW9uIGNhcGl0YWxpemVGaXJzdExldHRlcihzdHJpbmcpIHsKICByZXR1cm4gc3RyaW5nLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3RyaW5nLnNsaWNlKDEpCn0KCi8vYnVpbGQgc3RvcmUgZnVuY3Rpb25zCmZ1bmN0aW9uIGdldFN0b3JlICgpIHsKICBsZXQgc3VieGVkID0gWyd1c2VyJywgJ2JvdCddCiAgcmV0dXJuIHRhYmxlcy5yZWR1Y2UoKHByZXYsIHRhYmxlKSA9PiB7CiAgICBsZXQgY2FwID0gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyKHRhYmxlKQogICAgcmV0dXJuIHsKICAgICAgLi4ucHJldiwKICAgICAgW2BnZXQke2NhcH1gXTogYXN5bmMgZnVuY3Rpb24oaWQpIHsKICAgICAgICBsZXQgaXRlbSA9IHt9CiAgICAgICAgaXRlbSA9IGF3YWl0IGRiLmRiQWN0aW9uKHRhYmxlLCAnZ2V0Jywge2lkfSkKICAgICAgICBpZiAoIXN1YnhlZC5pbmNsdWRlcyh0YWJsZSkpIHsKICAgICAgICAgIHJldHVybiBpdGVtCiAgICAgICAgfQogICAgICAgIGlmICghaXRlbSkgewogICAgICAgICAgcmV0dXJuIGl0ZW0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNyZWF0ZShpdGVtLCB0YWJsZSkKICAgICAgfSwKICAgICAgW2ByZW1vdmUke2NhcH1gXTogZnVuY3Rpb24oaWQpIHsKICAgICAgICByZXR1cm4gZGIuZGJBY3Rpb24odGFibGUsICdyZW1vdmUnLCB7aWR9KQogICAgICB9LAogICAgICBbYGFkZCR7Y2FwfWBdOiBmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgcmV0dXJuIGRiLmRiQWN0aW9uKHRhYmxlLCAnYWRkJywgaXRlbSkKICAgICAgfQogICAgfQogIH0sIHt9KQp9CgoKZXhwb3J0IGNvbnN0IHN0b3JlID0gZ2V0U3RvcmUoKQoKLy8gQm90CmV4cG9ydCBjb25zdCBCb3QgPSBuZXcgU3VieCh7CiAgZ2V0IHJjICgpIHsKICAgIGNvbnN0IHJjID0gbmV3IFJpbmdDZW50cmFsKAogICAgICBwcm9jZXNzLmVudi5SSU5HQ0VOVFJBTF9CT1RfQ0xJRU5UX0lELAogICAgICBwcm9jZXNzLmVudi5SSU5HQ0VOVFJBTF9CT1RfQ0xJRU5UX1NFQ1JFVCwKICAgICAgcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfU0VSVkVSCiAgICApCiAgICByYy50b2tlbih0aGlzLnRva2VuKQogICAgcmV0dXJuIHJjCiAgfSwKICBhc3luYyB3cml0ZVRvRGIoaXRlbSkgewogICAgaWYgKGl0ZW0pIHsKICAgICAgYXdhaXQgZGIuZGJBY3Rpb24oJ2JvdCcsICdhZGQnLCBpdGVtKQogICAgfSBlbHNlIHsKICAgICAgYXdhaXQgZGIuZGJBY3Rpb24oJ2JvdCcsICd1cGRhdGUnLCB7CiAgICAgICAgaWQ6IHRoaXMuaWQsCiAgICAgICAgdXBkYXRlOiB7CiAgICAgICAgICB0b2tlbjogdGhpcy50b2tlbgogICAgICAgIH0KICAgICAgfSkKICAgIH0KICB9LAogIGFzeW5jIGF1dGhvcml6ZSAoY29kZSkgewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5hdXRob3JpemUoeyBjb2RlLCByZWRpcmVjdFVyaTogcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX1NFUlZFUiArICcvYm90LW9hdXRoJyB9KQogICAgfSBjYXRjaCAoZSkgewogICAgICBoYW5kbGVSQ0Vycm9yKCdCb3QgYXV0aG9yaXplJywgZSkKICAgIH0KICAgIGxldCB0b2tlbiA9IHRoaXMucmMudG9rZW4oKQogICAgbGV0IGlkID0gdG9rZW4ub3duZXJfaWQKICAgIHRoaXMudG9rZW4gPSB0b2tlbgogICAgdGhpcy5pZCA9IGlkCiAgICBhd2FpdCB0aGlzLndyaXRlVG9EYih7CiAgICAgIGlkLAogICAgICB0b2tlbgogICAgfSkKICB9LAogIGFzeW5jIHNldHVwV2ViSG9vayAoKSB7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLnJjLnBvc3QoJy9yZXN0YXBpL3YxLjAvc3Vic2NyaXB0aW9uJywgewogICAgICAgIGV2ZW50RmlsdGVyczogYm90RXZlbnRGaWx0ZXJzKCksCiAgICAgICAgZXhwaXJlc0luOiA1MDAwMDAwMDAsCiAgICAgICAgZGVsaXZlcnlNb2RlOiB7CiAgICAgICAgICB0cmFuc3BvcnRUeXBlOiAnV2ViSG9vaycsCiAgICAgICAgICBhZGRyZXNzOiBwcm9jZXNzLmVudi5SSU5HQ0VOVFJBTF9CT1RfU0VSVkVSICsgJy9ib3Qtd2ViaG9vaycKICAgICAgICB9CiAgICAgIH0pCiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGxldCBkYXRhID0gXy5nZXQoZSwgJ3Jlc3BvbnNlLmRhdGEnKSB8fCB7fQogICAgICBsZXQgc3RyID0gSlNPTi5zdHJpbmdpZnkoZGF0YSkKICAgICAgaWYgKHN0ci5pbmNsdWRlcygnU1VCLTQwNicpKSB7CiAgICAgICAgbG9nKCdib3Qgc3Vic2NyaWJlIGZhaWwsIHdpbGwgZG8gc3Vic2NyaWJlIG9uZSBtaW51dGVzIGxhdGVyJykKICAgICAgICBzZXRUaW1lb3V0KAogICAgICAgICAgKCkgPT4gdGhpcy5yZW5ld1dlYkhvb2tzKCksCiAgICAgICAgICA2MCAqIDEwMDAKICAgICAgICApCiAgICAgIH0gZWxzZSB7CiAgICAgICAgaGFuZGxlUkNFcnJvcignQm90IHNldHVwV2ViSG9vaycsIGUpCiAgICAgICAgdGhyb3cgZQogICAgICB9CiAgICB9CiAgfSwKICBhc3luYyByZW5ld1dlYkhvb2tzICgpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHIgPSBhd2FpdCB0aGlzLnJjLmdldCgnL3Jlc3RhcGkvdjEuMC9zdWJzY3JpcHRpb24nKQogICAgICBsZXQgZmlsdGVyZWQgPSByLmRhdGEucmVjb3Jkcy5maWx0ZXIoCiAgICAgICAgciA9PiB7CiAgICAgICAgICByZXR1cm4gci5kZWxpdmVyeU1vZGUuYWRkcmVzcyA9PT0gcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX1NFUlZFUiArICcvYm90LXdlYmhvb2snCiAgICAgICAgfQogICAgICApCiAgICAgIGRlYnVnKCdib3Qgc3VicyBsaXN0JywgZmlsdGVyZWQubWFwKGcgPT4gZy5pZCkuam9pbignLCcpKQogICAgICBhd2FpdCB0aGlzLnNldHVwV2ViSG9vaygpCiAgICAgIGZvciAobGV0IHN1YiBvZiBmaWx0ZXJlZCkgewogICAgICAgIGF3YWl0IHRoaXMuZGVsU3Vic2NyaXB0aW9uKHN1Yi5pZCkKICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICBoYW5kbGVSQ0Vycm9yKCdib3QgcmVuZXdXZWJIb29rcycsIGUpCiAgICB9CiAgfSwKICBhc3luYyBkZWxTdWJzY3JpcHRpb24gKGlkKSB7CiAgICBkZWJ1ZygnZGVsIGJvdCBzdWIgaWQ6JywgaWQpCiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLnJjLmRlbGV0ZShgL3Jlc3RhcGkvdjEuMC9zdWJzY3JpcHRpb24vJHtpZH1gKQogICAgfSBjYXRjaCAoZSkgewogICAgICBoYW5kbGVSQ0Vycm9yKCdib3QgZGVsU3Vic2NyaXB0aW9uJywgZSkKICAgIH0KICB9LAogIGFzeW5jIHNlbmRNZXNzYWdlIChncm91cElkLCBtZXNzYWdlT2JqKSB7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLnJjLnBvc3QoYC9yZXN0YXBpL3YxLjAvZ2xpcC9ncm91cHMvJHtncm91cElkfS9wb3N0c2AsIG1lc3NhZ2VPYmopCiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGhhbmRsZVJDRXJyb3IoJ0JvdCBzZW5kTWVzc2FnZScsIGUpCiAgICB9CiAgfSwKICBhc3luYyB2YWxpZGF0ZSAoKSB7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLnJjLmdldCgnL3Jlc3RhcGkvdjEuMC9hY2NvdW50L34vZXh0ZW5zaW9uL34nKQogICAgICByZXR1cm4gdHJ1ZQogICAgfSBjYXRjaCAoZSkgewogICAgICBoYW5kbGVSQ0Vycm9yKCdCb3QgdmFsaWRhdGUnLCBlKQogICAgICBjb25zdCBlcnJvckNvZGUgPSBfLmdldChlLCAncmVzcG9uc2UuZGF0YS5lcnJvckNvZGUnKQogICAgICBpZiAoZXJyb3JDb2RlID09PSAnT0FVLTIzMicgfHwgZXJyb3JDb2RlID09PSAnQ01OLTQwNScpIHsKICAgICAgICBhd2FpdCBzdG9yZS5yZW1vdmVCb3RbdGhpcy5pZF0KICAgICAgICBsb2coYEJvdCB1c2VyICR7dGhpcy5pZH0gaGFzIGJlZW4gZGVsZXRlZGApCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0KICAgIH0KICB9Cn0pCgovLyBVc2VyCmV4cG9ydCBjb25zdCBVc2VyID0gbmV3IFN1YngoewogIGdyb3Vwczoge30sCiAgZ2V0IHJjICgpIHsKICAgIGNvbnN0IHJjID0gbmV3IFJpbmdDZW50cmFsKAogICAgICBwcm9jZXNzLmVudi5SSU5HQ0VOVFJBTF9VU0VSX0NMSUVOVF9JRCwKICAgICAgcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfVVNFUl9DTElFTlRfU0VDUkVULAogICAgICBwcm9jZXNzLmVudi5SSU5HQ0VOVFJBTF9TRVJWRVIKICAgICkKICAgIHJjLnRva2VuKHRoaXMudG9rZW4pCiAgICByZXR1cm4gcmMKICB9LAogIGFzeW5jIHdyaXRlVG9EYihpdGVtKSB7CiAgICBpZiAoaXRlbSkgewogICAgICBhd2FpdCBkYi5kYkFjdGlvbigndXNlcicsICdhZGQnLCBpdGVtKQogICAgfSBlbHNlIHsKICAgICAgYXdhaXQgZGIuZGJBY3Rpb24oJ3VzZXInLCAndXBkYXRlJywgewogICAgICAgIGlkOiB0aGlzLmlkLAogICAgICAgIHVwZGF0ZTogewogICAgICAgICAgdG9rZW46IHRoaXMudG9rZW4sCiAgICAgICAgICBncm91cHM6IHRoaXMuZ3JvdXBzCiAgICAgICAgfQogICAgICB9KQogICAgfQogIH0sCiAgYXV0aG9yaXplVXJpIChncm91cElkLCBib3RJZCkgewogICAgcmV0dXJuIHRoaXMucmMuYXV0aG9yaXplVXJpKHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX0JPVF9TRVJWRVIgKyAnL3VzZXItb2F1dGgnLCB7CiAgICAgIHN0YXRlOiBncm91cElkICsgJzonICsgYm90SWQsCiAgICAgIHJlc3BvbnNlVHlwZTogJ2NvZGUnCiAgICB9KQogIH0sCiAgYXN5bmMgYXV0aG9yaXplIChjb2RlKSB7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLnJjLmF1dGhvcml6ZSh7IGNvZGUsIHJlZGlyZWN0VXJpOiBwcm9jZXNzLmVudi5SSU5HQ0VOVFJBTF9CT1RfU0VSVkVSICsgJy91c2VyLW9hdXRoJyB9KQogICAgfSBjYXRjaCAoZSkgewogICAgICBoYW5kbGVSQ0Vycm9yKCdVc2VyIGF1dGhvcml6ZScsIGUpCiAgICB9CiAgICBsZXQgdG9rZW4gPSB0aGlzLnJjLnRva2VuKCkKICAgIGxldCBpZCA9IHRva2VuLm93bmVyX2lkCiAgICB0aGlzLnRva2VuID0gdG9rZW4KICAgIHRoaXMuaWQgPSBpZAogICAgYXdhaXQgdGhpcy53cml0ZVRvRGIoewogICAgICBpZCwKICAgICAgdG9rZW4sCiAgICAgIGdyb3Vwczoge30KICAgIH0pCiAgfSwKICBhc3luYyByZWZyZXNoICgpIHsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMucmMucmVmcmVzaCgpCiAgICAgIHRoaXMudG9rZW4gPSB0aGlzLnJjLnRva2VuKCkKICAgIH0gY2F0Y2goZSkgewogICAgICBoYW5kbGVSQ0Vycm9yKCdVc2VyIHJlZnJlc2ggdG9rZW4nLCBlKQogICAgICBhd2FpdCBzdG9yZS5yZW1vdmVVc2VyKHRoaXMuaWQpCiAgICAgIGxvZyhgVXNlciAke3RoaXMudG9rZW4ub3duZXJfaWR9IHJlZnJlc2ggdG9rZW4gaGFzIGV4cGlyZWRgKQogICAgfQogIH0sCiAgYXN5bmMgcmVuZXdXZWJIb29rcyAoKSB7CiAgICB0cnkgewogICAgICBjb25zdCByID0gYXdhaXQgdGhpcy5yYy5nZXQoJy9yZXN0YXBpL3YxLjAvc3Vic2NyaXB0aW9uJykKICAgICAgbGV0IGZpbHRlcmVkID0gci5kYXRhLnJlY29yZHMuZmlsdGVyKAogICAgICAgIHIgPT4gewogICAgICAgICAgcmV0dXJuIHIuZGVsaXZlcnlNb2RlLmFkZHJlc3MgPT09IHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX0JPVF9TRVJWRVIgKyAnL3VzZXItd2ViaG9vaycKICAgICAgICB9CiAgICAgICkKICAgICAgbG9nKCd1c2VyIHN1YnMgbGlzdCcsIGZpbHRlcmVkLm1hcChnID0+IGcuaWQpLmpvaW4oJywnKSkKICAgICAgYXdhaXQgdGhpcy5zZXR1cFdlYkhvb2soKQogICAgICBmb3IgKGxldCBzdWIgb2YgZmlsdGVyZWQpIHsKICAgICAgICBhd2FpdCB0aGlzLmRlbFN1YnNjcmlwdGlvbihzdWIuaWQpCiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcigndXNlciByZW5ld1dlYkhvb2tzJywgZSkKICAgIH0KICB9LAogIGFzeW5jIGRlbFN1YnNjcmlwdGlvbiAoaWQpIHsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMucmMuZGVsZXRlKGAvcmVzdGFwaS92MS4wL3N1YnNjcmlwdGlvbi8ke2lkfWApCiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGhhbmRsZVJDRXJyb3IoYHVzZXIgZGVsU3Vic2NyaXB0aW9uICR7aWR9YCwgZSkKICAgIH0KICB9LAogIGFzeW5jIHNldHVwV2ViSG9vayAoKSB7IC8vIHNldHVwIFdlYkhvb2sgZm9yIHZvaWNlbWFpbAogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5wb3N0KCcvcmVzdGFwaS92MS4wL3N1YnNjcmlwdGlvbicsIHsKICAgICAgICBldmVudEZpbHRlcnM6IHVzZXJFdmVudEZpbHRlcnMoKSwKICAgICAgICBleHBpcmVzSW46IGV4cGlyZXNJbigpLAogICAgICAgIGRlbGl2ZXJ5TW9kZTogewogICAgICAgICAgdHJhbnNwb3J0VHlwZTogJ1dlYkhvb2snLAogICAgICAgICAgYWRkcmVzczogcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX1NFUlZFUiArICcvdXNlci13ZWJob29rJwogICAgICAgIH0KICAgICAgfSkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignVXNlciBzZXR1cFdlYkhvb2snLCBlKQogICAgfQogIH0sCiAgYXN5bmMgcmVtb3ZlR3JvdXAoaWQpIHsKICAgIGRlbGV0ZSB0aGlzLmdyb3Vwc1tpZF0KICAgIGF3YWl0IHRoaXMud3JpdGVUb0RiKCkKICB9LAogIGFzeW5jIGFkZEdyb3VwIChncm91cElkLCBib3RJZCkgewogICAgY29uc3QgaGFzTm9Hcm91cCA9IE9iamVjdC5rZXlzKHRoaXMuZ3JvdXBzKS5sZW5ndGggPT09IDAKICAgIHRoaXMuZ3JvdXBzW2dyb3VwSWRdID0gYm90SWQKICAgIGF3YWl0IHRoaXMud3JpdGVUb0RiKCkKICAgIGlmIChoYXNOb0dyb3VwKSB7CiAgICAgIGF3YWl0IHRoaXMuc2V0dXBXZWJIb29rKCkKICAgIH0KICB9LAogIGFzeW5jIGdldFZvaWNlTWFpbHMgKGNvdW50KSB7CiAgICBjb25zdCByID0gYXdhaXQgdGhpcy5yYy5nZXQoJy9yZXN0YXBpL3YxLjAvYWNjb3VudC9+L2V4dGVuc2lvbi9+L21lc3NhZ2Utc3RvcmUnLCB7CiAgICAgIHBhcmFtczogewogICAgICAgIG1lc3NhZ2VUeXBlOiAnVm9pY2VNYWlsJywKICAgICAgICBwZXJQYWdlOiBjb3VudAogICAgICB9CiAgICB9KQogICAgcmV0dXJuIHIuZGF0YS5yZWNvcmRzCiAgfSwKICAvKgogIGFzeW5jIHN5bmNWb2ljZU1haWxzIChwYXJhbXMgPSB7CiAgICByZWNvcmRDb3VudDogMTAsCiAgICBzeW5jVHlwZTogJ0ZTeW5jJwogIH0pIHsKICAgIGNvbnN0IHIgPSBhd2FpdCB0aGlzLnJjLmdldCgnL3Jlc3RhcGkvdjEuMC9hY2NvdW50L34vZXh0ZW5zaW9uL34vbWVzc2FnZS1zeW5jJywgewogICAgICBwYXJhbXM6IHsKICAgICAgICAuLi5wYXJhbXMsCiAgICAgICAgbWVzc2FnZVR5cGU6ICdWb2ljZU1haWwnCiAgICAgIH0KICAgIH0pCiAgICByZXR1cm4gci5kYXRhLnJlY29yZHMKICB9LAogICovCiAgYXN5bmMgcHJvY2Vzc1ZvaWNlTWFpbCAobmV3TWFpbENvdW50ID0gMTApIHsKICAgIGlmICghT2JqZWN0LmtleXModGhpcy5ncm91cHMpKSB7CiAgICAgIHJldHVybgogICAgfQogICAgbGV0IHZvaWNlTWFpbHMgPSBhd2FpdCB0aGlzLmdldFZvaWNlTWFpbHMobmV3TWFpbENvdW50KQogICAgbGV0IHVzZXJJZCA9IHRoaXMuaWQKICAgIGxldCBoZWFkZXJzID0gdGhpcy5yYy5fYmVhcmVyQXV0aG9yaXphdGlvbkhlYWRlcigpCiAgICBmb3IgKGxldCBtYWlsIG9mIHZvaWNlTWFpbHMpIHsKICAgICAgbGV0IG1zZyA9IGF3YWl0IHByb2Nlc3NNYWlsKG1haWwsIGhlYWRlcnMpCiAgICAgIGF3YWl0IHRoaXMuc2VuZFZvaWNlTWFpbEluZm8oCiAgICAgICAgcmVzdWx0Rm9ybWF0dGVyKHVzZXJJZCwgbXNnIHx8IHt9KQogICAgICApCiAgICB9CiAgfSwKICBhc3luYyBzZW5kVm9pY2VNYWlsSW5mbyAocHJvY2Vzc2VkTWFpbEluZm8gPSAnJykgewogICAgZm9yIChjb25zdCBncm91cElkIG9mIE9iamVjdC5rZXlzKHRoaXMuZ3JvdXBzKSkgewogICAgICBjb25zdCBib3RJZCA9IHRoaXMuZ3JvdXBzW2dyb3VwSWRdCiAgICAgIGNvbnN0IGJvdCA9IGF3YWl0IHN0b3JlLmdldEJvdChib3RJZCkKICAgICAgYXdhaXQgYm90LnNlbmRNZXNzYWdlKAogICAgICAgIGdyb3VwSWQsCiAgICAgICAgeyB0ZXh0OiBwcm9jZXNzZWRNYWlsSW5mbyB9CiAgICAgICkKICAgIH0KICB9Cn0pCgovKioKICogY3JlYXRlIGluc3RhbmNlIGZyb20gdXNlci9ib3QgaW5mbwogKiBAcGFyYW0ge29iamVjdH0gaXRlbQogKiBAcGFyYW0geyp9IHR5cGUgCiAqLwphc3luYyBmdW5jdGlvbiBjcmVhdGUoaXRlbSwgdHlwZSkgewogIGxldCBkaWN0ID0gewogICAgYm90OiBCb3QsCiAgICB1c2VyOiBVc2VyCiAgfQogIGxldCBpbnN0ID0gbmV3IGRpY3RbdHlwZV0oaXRlbSkKICByZXR1cm4gaW5zdAp9Cg==</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/bot-webhook.js" data-mode="javascript">LyoqCiAqIHVzZXIgb2F1dGggYnkgdHlsZXIKICovCgppbXBvcnQge3Jlc3VsdCwgc3Vic2NyaWJlSW50ZXJ2YWx9IGZyb20gJy4vY29tbW9uJwppbXBvcnQge1VzZXIsIHN0b3JlfSBmcm9tICcuL3N0b3JlJwoKZXhwb3J0IGRlZmF1bHQgYXN5bmMgKGV2ZW50KSA9PiB7CiAgY29uc3QgbWVzc2FnZSA9IGV2ZW50LmJvZHkKICBsZXQgeyBib2R5IH0gPSBtZXNzYWdlCiAgbGV0IG1zZyA9IHJlc3VsdCgnYm90IFdlYkhvb2sgcmVwbGllZCcsIDIwMCwgewogICAgaGVhZGVyczogewogICAgICAndmFsaWRhdGlvbi10b2tlbic6IGV2ZW50LmhlYWRlcnNbJ3ZhbGlkYXRpb24tdG9rZW4nXSB8fCBldmVudC5oZWFkZXJzWydWYWxpZGF0aW9uLVRva2VuJ10KICAgIH0KICB9KQogIGlmICghYm9keSkgewogICAgcmV0dXJuIG1zZwogIH0KCiAgbGV0IGJvdElkID0gbWVzc2FnZS5vd25lcklkCgogIC8vaGFuZGxlIGV4cGlyZSByZW1pbmRlciBldmVudCwgcmVzdWJzY3JpYmUKICAvLyBpZiAobWVzc2FnZS5ldmVudCA9PT0gc3Vic2NyaWJlSW50ZXJ2YWwoKSkgewogIC8vICAgbGV0IGJvdDEgPSBhd2FpdCBzdG9yZS5nZXRCb3QoYm90SWQpCiAgLy8gICBpZiAoYm90MSkgewogIC8vICAgICBhd2FpdCBib3QxLnJlbmV3V2ViSG9va3MoKQogIC8vICAgfQogIC8vICAgcmV0dXJuIG1zZwogIC8vIH0KCiAgc3dpdGNoIChib2R5LmV2ZW50VHlwZSkgewoKICAgIC8vYm90IGpvaW4gZ3JvdXAKICAgIGNhc2UgJ0dyb3VwSm9pbmVkJzoKICAgICAgaWYgKGJvZHkudHlwZSA9PT0gJ1ByaXZhdGVDaGF0JykgewogICAgICAgIGNvbnN0IGJvdCA9IGF3YWl0IHN0b3JlLmdldEJvdChib3RJZCkKICAgICAgICBpZiAoIWJvdCkgewogICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICAgICAgYXdhaXQgYm90LnNlbmRNZXNzYWdlKAogICAgICAgICAgYm9keS5pZCwKICAgICAgICAgIHsKICAgICAgICAgICAgdGV4dDogYEhlbGxvLCBJIGFtIGEgY2hhdGJvdC4KUGxlYXNlIHJlcGx5ICIhWzpQZXJzb25dKCR7Ym90SWR9KSIgaWYgeW91IHdhbnQgdG8gdGFsayB0byBtZS5gCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICB9CiAgICAgIGJyZWFrCgogICAgLy9ib3QgZ290IHBvc3QKICAgIGNhc2UgJ1Bvc3RBZGRlZCc6CgogICAgICAvL29ubHkgcmVzcG9uZCB0byBAYm90IGV2ZW50CiAgICAgIGlmIChib2R5LmNyZWF0b3JJZCA9PT0gYm90SWQgfHwgYm9keS50ZXh0LmluZGV4T2YoYCFbOlBlcnNvbl0oJHtib3RJZH0pYCkgPT09IC0xKSB7CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgICB2YXIgYm90ID0gYXdhaXQgc3RvcmUuZ2V0Qm90KGJvdElkKQoKICAgICAgLy9ubyBib3QgaW4gZGF0YWJhc2UKICAgICAgaWYgKCFib3QpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgLy91c2VyIHVubW9uaXQgdm9pY2VtYWlsCiAgICAgIGlmICgvXGJ1bm1vbml0b3JcYi9pLnRlc3QoYm9keS50ZXh0KSkgeyAvLyBtb25pdG9yIHZvaWNlbWFpbAogICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBzdG9yZS5nZXRVc2VyKGJvZHkuY3JlYXRvcklkKQogICAgICAgIGlmICh1c2VyKSB7CiAgICAgICAgICBhd2FpdCB1c2VyLnJlbW92ZUdyb3VwKGJvZHkuZ3JvdXBJZCkKICAgICAgICAgIGF3YWl0IGJvdC5zZW5kTWVzc2FnZShib2R5Lmdyb3VwSWQsIHsgdGV4dDogYCFbOlBlcnNvbl0oJHtib2R5LmNyZWF0b3JJZH0pLCBzdG9wIG1vbml0b3IgeW91ciB2b2ljZW1haWwgbm93IVxuSWYgeW91IHdhbnQgbWUgdG8gbW9uaXRvciB5b3VyIHZvaWNlbWFpbCBhZ2FpbiwgcGxlYXNlIHJlcGx5ICIhWzpQZXJzb25dKCR7Ym90SWR9KSBtb25pdG9yImAgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXdhaXQgYm90LnNlbmRNZXNzYWdlKGJvZHkuZ3JvdXBJZCwgewogICAgICAgICAgICB0ZXh0OiBgIVs6UGVyc29uXSgke2JvZHkuY3JlYXRvcklkfSksIElmIHlvdSB3YW50IG1lIHRvIG1vbml0b3IgeW91ciB2b2ljZW1haWwsIHBsZWFzZSByZXBseSAiIVs6UGVyc29uXSgke2JvdElkfSkgbW9uaXRvciIgZmlyc3QuYAogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vdXNlciBtb25pdCB2b2ljZW1haWwKICAgICAgZWxzZSBpZiAoL1xibW9uaXRvclxiL2kudGVzdChib2R5LnRleHQpKSB7IC8vIG1vbml0b3Igdm9pY2VtYWlsCiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHN0b3JlLmdldFVzZXIoYm9keS5jcmVhdG9ySWQpCiAgICAgICAgaWYgKHVzZXIpIHsKICAgICAgICAgIGF3YWl0IHVzZXIuYWRkR3JvdXAoYm9keS5ncm91cElkLCBib3RJZCkKICAgICAgICAgIGF3YWl0IGJvdC5zZW5kTWVzc2FnZShib2R5Lmdyb3VwSWQsIHsgdGV4dDogYCFbOlBlcnNvbl0oJHtib2R5LmNyZWF0b3JJZH0pLCBub3cgeW91ciB2b2ljZW1haWwgaXMgbW9uaXRvcmVkIVxuSWYgeW91IHdhbnQgbWUgdG8gKipzdG9wIG1vbml0b3IqKiB5b3VyIHZvaWNlbWFpbCwgcGxlYXNlIHJlcGx5ICIhWzpQZXJzb25dKCR7Ym90SWR9KSB1bm1vbml0b3IiYCB9KQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCB1c2VyID0gbmV3IFVzZXIoKQogICAgICAgICAgY29uc3QgYXV0aG9yaXplVXJpID0gdXNlci5hdXRob3JpemVVcmkoYm9keS5ncm91cElkLCBib3RJZCkKICAgICAgICAgIGF3YWl0IGJvdC5zZW5kTWVzc2FnZShib2R5Lmdyb3VwSWQsIHsKICAgICAgICAgICAgdGV4dDogYCFbOlBlcnNvbl0oJHtib2R5LmNyZWF0b3JJZH0pLCBbY2xpY2sgaGVyZV0oJHthdXRob3JpemVVcml9KSB0byBhdXRob3JpemUgbWUgdG8gYWNjZXNzIHlvdXIgUmluZ0NlbnRyYWwgZGF0YSBmaXJzdC5gCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy9vdGhlciBzaXR1YXRpb24sIGp1c3QgdGlwIHVzZXIgdG8gbW9uaXQKICAgICAgZWxzZSB7CiAgICAgICAgYXdhaXQgYm90LnNlbmRNZXNzYWdlKGJvZHkuZ3JvdXBJZCwgewogICAgICAgICAgdGV4dDogYElmIHlvdSB3YW50IG1lIHRvIG1vbml0b3IgeW91ciB2b2ljZW1haWwsIHBsZWFzZSByZXBseSAiIVs6UGVyc29uXSgke2JvdElkfSkgbW9uaXRvciJgCiAgICAgICAgfSkKICAgICAgfQogICAgICBicmVhawogICAgZGVmYXVsdDoKICAgICAgYnJlYWsKICB9CgogIHJldHVybiBtc2cKfQo=</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/voicemail-process.js" data-mode="javascript">LyoqCiAqIHJlYWQgdm9pY2VtYWlsIGFuZCBwcm9jZXNzIGl0CiAqLwoKaW1wb3J0IF8gZnJvbSAnbG9kYXNoJwppbXBvcnQge3NwZWVjaDJ0ZXh0fSBmcm9tICdhdWRpby1hbmFseXNpcy1zZXJ2aWNlL2Rpc3QvdXJsMnRleHQnCmltcG9ydCB7dGV4dEFuYWx5c2lzfSBmcm9tICdhdWRpby1hbmFseXNpcy1zZXJ2aWNlL2Rpc3QvdGV4dC1hbmFseXNpcycKaW1wb3J0IHtzdG9yZX0gZnJvbSAnLi9zdG9yZScKaW1wb3J0IHtsb2d9IGZyb20gJy4vY29tbW9uJwppbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0bycKCi8qKgogKiBwcm9jZXNzIHZvaWNlIG1haWwKICogQHBhcmFtIHtvYmplY3R9IG1haWwKICogQHBhcmFtIHtvYmplY3R9IHJjCiAqLwpleHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc01haWwgKG1haWwsIGhlYWRlcnMpIHsKICBsZXQgdXJsID0gXy5nZXQobWFpbCwgJ2F0dGFjaG1lbnRzWzBdLnVyaScpCiAgaWYgKCF1cmwpIHsKICAgIHJldHVybiAnJwogIH0KICBsZXQgbWQ1ID0gY3J5cHRvLmNyZWF0ZUhhc2goJ21kNScpLnVwZGF0ZSh1cmwpLmRpZ2VzdCgnaGV4JykKICBsZXQgY2FjaGVkID0gYXdhaXQgc3RvcmUuZ2V0Q2FjaGUobWQ1KQogIGlmIChjYWNoZWQpIHsKICAgIGxvZygndXNlIGNhY2hlIGZvcicsIHVybCwgbWQ1KQogICAgcmV0dXJuIGNhY2hlZAogIH0KICBsZXQgdGV4dCA9IGF3YWl0IHNwZWVjaDJ0ZXh0KAogICAgdXJsLCBoZWFkZXJzCiAgKQogIGlmICghXy5pc1N0cmluZyh0ZXh0KSkgewogICAgcmV0dXJuICcnCiAgfQogIGxldCByZXN1bHQgPSBhd2FpdCB0ZXh0QW5hbHlzaXModGV4dCkKICBpZiAoIXJlc3VsdCB8fCAhcmVzdWx0LnRleHQpIHsKICAgIHJldHVybiAnJwogIH0KICBhd2FpdCBzdG9yZS5hZGRDYWNoZSh7CiAgICBpZDogbWQ1LAogICAgcmVzdWx0CiAgfSkKICByZXR1cm4gcmVzdWx0Cn0K</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><div class="saurus-file-actions"><a href="https://github.com/ringcentral-tutorials/ringcentral-ai-bot" target="_blank" class="explorer-get-code"><i class="fa fa-lg fa-github-square"></i>View Code on GitHub</a><a href="https://github.com/ringcentral-tutorials/ringcentral-ai-bot/archive/master.zip" target="_blank" class="explorer-get-code"><i class="fa fa-lg icon-download"></i>Download Source Code</a></div></div></div></div><footer><div class="footer-content"><div class="footer-content-row layout-2-cols"><div class="footer-content-row-left"><div class="footer-logo"><a href="http://www.ringcentral.com"><span>Back to the main site</span></a></div></div><div class="footer-content-row-right"><ul class="footer-text-links"><li><a href="http://www.ringcentral.com/legal.html" target="_blank"><span>Legal</span></a></li><li><a href="http://www.ringcentral.com/security-statement.html" target="_blank"><span>Security Policy</span></a></li><li><a href="http://www.ringcentral.com/legal/privacy-policy.html" target="_blank"><span>Privacy Policy</span></a></li><li><a ng-href="https://devcommunity.ringcentral.com" target="_blank" href="https://devcommunity.ringcentral.com"><span>Community</span></a></li><li><a href="https://medium.com/ringcentral-developers" target="_blank"><span>Blog</span></a></li></ul></div></div><div class="footer-content-row footer-content-row-last layout-2-cols"><div class="footer-content-row-left"><span class="footer-copyright">© 1999-<span ng-bind="::main.nowObj|date:'yyyy'" class="footer-copyright-to ng-binding">2017</span> RingCentral, Inc. All rights reserved.</span></div><div class="footer-content-row-right"><div class="footer-image-links"><div class="footer-image-link footer-image-link-facebook"><a target="_blank" href="http://www.facebook.com/ringcentral"><i class="fa icon-facebook"></i></a></div><div class="footer-image-link footer-image-link-twitter"><a target="_blank" href="http://twitter.com/ringcentraldevs"><i class="fa icon-twitter"></i></a></div><div class="footer-image-link footer-image-link-google-plus"><a target="_blank" href="https://www.google.com/+ringcentral"><i class="fa icon-google_plus"></i></a></div><div class="footer-image-link footer-image-link-linkedin"><a target="_blank" href="http://www.linkedin.com/company/ringcentral"><i class="fa icon-linkedin"></i></a></div><div class="footer-image-link footer-image-link-youtube"><a target="_blank" href="http://www.youtube.com/ringcentral"><i class="fa icon-youtube"></i></a></div></div></div></div></div></footer></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script><script>window.tutorialName="Building a RingCentral AI Chatbot";</script><script src="viewsaurus.js"></script></body></html>